{{!-- Wounds List Part - Updates independently from paper doll --}}
<div class="tab combat" data-group="primary" data-tab="combat" data-application-part="combatWoundsList">
    {{#if (eq @root.combat.patientCardVersion "extended")}}
    <section class="combat-section wounds-section healing-panel-section wounds-list-part">
        <h3 class="section-title">{{localize "NEUROSHIMA.PatientCard.Wounds"}}</h3>
        <div class="wounds-list-container">
            {{#if combat.wounds.length}}
                {{#each combat.patientData.locations as |location|}}
                
                {{!-- Location Header --}}
                <div class="location-wounds-header {{#if (eq location.key @root.combat.selectedWoundLocation)}}active{{/if}}" data-location="{{location.key}}">
                    <h4 class="location-wounds-title" data-location-debug="{{location.key}}">{{location.label}}</h4>
                    {{#if ../owner}}
                    <button type="button" class="btn-add-wound" data-action="createItem" data-type="wound" data-location="{{location.key}}" title="{{localize 'DOCUMENT.Create'}}">
                        <i class="fas fa-plus"></i>
                    </button>
                    {{/if}}
                </div>
                
                {{!-- Wounds Group (Always rendered, shows wounds only if they exist) --}}
                {{#with (lookup @root.combat.woundsByLocation location.key) as |locationWounds|}}
                <div class="location-wounds-group {{#if (eq location.key @root.combat.selectedWoundLocation)}}active{{/if}}" data-location="{{location.key}}">
                    {{#if (gt locationWounds.length 0)}}
                        {{#each locationWounds as |wound|}}
                        <div class="wound-item wound-item-inline item" data-item-id="{{wound.id}}" data-uuid="{{wound.uuid}}" draggable="true">
                            {{!-- Type, Name, and Inline Editing --}}
                            <div class="wound-item-content">
                                {{#if ../../owner}}
                                <select name="items.{{wound.id}}.system.damageType" class="wound-type-select" title="{{localize 'NEUROSHIMA.Items.Fields.DamageType'}}">
                                    {{selectOptions @root.config.damageTypes selected=wound.damageType localize=true}}
                                </select>
                                {{else}}
                                <span class="wound-type">{{wound.damageType}}</span>
                                {{/if}}
                                <span class="wound-item-name">{{wound.name}}</span>
                                
                                {{!-- Penalty (inline, editable) --}}
                                {{#if ../../owner}}
                                <input type="number" name="items.{{wound.id}}.system.penalty" value="{{wound.penalty}}" class="wound-penalty-input" data-dtype="Number" min="0" max="100" title="{{localize 'NEUROSHIMA.Wound.TotalPenalty'}}" />
                                {{else}}
                                <span class="wound-penalty" title="{{localize 'NEUROSHIMA.Wound.TotalPenalty'}}">{{wound.penalty}}%</span>
                                {{/if}}
                                
                                {{!-- Healing Days --}}
                                <span class="wound-days" title="{{localize 'NEUROSHIMA.Wound.Days'}}">{{#if wound.estimatedHealingDays}}{{wound.estimatedHealingDays}}d{{else}}-{{/if}}</span>
                                
                                {{!-- Status Icons --}}
                                <div class="wound-status-icons">
                                    {{#if wound.hadFirstAid}}<i class="fas fa-syringe" title="{{localize 'NEUROSHIMA.Skills.firstAid'}}"></i>{{/if}}
                                    {{#if wound.isHealing}}<i class="fas fa-medkit active" title="{{localize 'NEUROSHIMA.Actions.Healing'}}"></i>{{/if}}
                                    {{#if (gt wound.healingAttempts 0)}}<span class="attempts-badge" title="{{localize 'NEUROSHIMA.Wound.AttemptCount'}}">{{wound.healingAttempts}}Ã—</span>{{/if}}
                                </div>
                                
                                {{!-- Controls --}}
                                {{#if ../../owner}}
                                <div class="wound-inline-controls">
                                    <a class="item-control {{#if wound.isHealing}}active{{/if}}" data-action="toggleHealing" title="{{localize 'NEUROSHIMA.Actions.Healing'}}">
                                        <i class="fas fa-medkit"></i>
                                    </a>
                                    <a class="item-control" data-action="deleteItem" title="{{localize 'DOCUMENT.Delete'}}">
                                        <i class="fas fa-trash"></i>
                                    </a>
                                </div>
                                {{/if}}
                            </div>
                        </div>
                        {{/each}}
                    {{else}}
                        <p class="no-wounds-in-location" style="text-align: center; padding: 8px; opacity: 0.6;">{{localize 'NEUROSHIMA.PatientCard.NoWounds'}}</p>
                    {{/if}}
                </div>
                {{/with}}
                {{/each}}
            {{else}}
                <div class="no-wounds-message">
                    <i class="fas fa-check-circle"></i>
                    <p>{{localize "NEUROSHIMA.PatientCard.NoWounds"}}</p>
                </div>
            {{/if}}
        </div>
    </section>
    {{/if}}
</div>
